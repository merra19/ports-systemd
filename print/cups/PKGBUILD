# description	: The Common Unix Printing System
# depends	: libpaper zlib linux-api-headers acl attr dbus pam 
# depends	: openssl libusb avahi colord xdg-utils gnutls systemd
# optional  : php

pkgname=cups
pkgver=2.4.14
pkgrel=1
options=(!lto)
source=(https://github.com/OpenPrinting/cups/releases/download/v$pkgver/$pkgname-$pkgver-source.tar.gz
        cups $pkgname.hooks)
backup=(etc/cups/cupsd.conf etc/cups/snmp.conf etc/cups/cups-files.conf)

build() {
	cd $pkgname-$pkgver

    # The build system uses only DSOFLAGS but not LDFLAGS to build some libraries.
    export DSOFLAGS=${LDFLAGS}

	./configure \
        --libdir=/usr/lib \
        --with-rcdir=/tmp/cupsinit \
        --with-rundir=/run/cups \
        --with-system-groups=lpadmin \
        --enable-libpaper \
		--with-docdir=/usr/share/cups/doc-$pkgver
	make

    mkdir -p "$pkgdir"/etc/pam.d

	make DESTDIR="$pkgdir" install

    rm -rf "$pkgdir"/tmp

	mkdir -p "$pkgdir"/usr/share/doc
	ln -svnf ../cups/doc-$pkgver "$pkgdir"/usr/share/doc/$pkgname-$pkgver

	echo "ServerName /run/cups/cups.sock" > "$pkgdir"/etc/cups/client.conf

	install -Dm 0644 "$srcdir"/cups "$pkgdir"/etc/pam.d/cups

    install -Dm755 "$srcdir"/$pkgname.hooks "$pkgdir"/usr/share/blfs-bootscripts/hooks/$pkgname.hooks
}
