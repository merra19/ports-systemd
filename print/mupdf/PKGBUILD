# description	: Legacy library for PPD files, split out of cups-filters
# depends	: harfbuzz openjpeg libglvnd libjpeg-turbo curl openssl
# depends	: freeglut zlib xorg-libs xorg-proto xdg-utils

pkgname=mupdf
pkgver=1.26.5
pkgrel=1
source=(https://www.mupdf.com/downloads/archive/mupdf-$pkgver-source.tar.gz
        user.make)

build() {
    cd $pkgname-$pkgver-source

    cp ../user.make ./

    export XCFLAGS="$CFLAGS -fPIC"
    make -j1 build=release shared=yes
    unset XCFLAGS

    make prefix=/usr \
        shared=yes \
        docdir=/usr/share/doc/-$pkgver \
        DESTDIR="$pkgdir" \
        install                            &&

    ln -sfv libmupdf.so.${pkgver#*.} "$pkgdir"/usr/lib/libmupdf.so   &&
    ln -sfv libmupdf.so.${pkgver#*.} "$pkgdir"/usr/lib/libmupdf.so.${pkgver#*.*.} &&
    chmod 755 "$pkgdir"/usr/lib/libmupdf.so
    ln -sfv mupdf-x11 "$pkgdir"/usr/bin/mupdf
}