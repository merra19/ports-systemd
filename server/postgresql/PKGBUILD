# description	: PostgreSQL RDBMS
# depends	: less intltool icu pam perl python readline openssl tcl 
# depends	: libxml2 zlib zstd util-linux libxslt openjade
# depends	: docbook-dtd45 docbook-dsssl docbook-utils perl-sgmlspm
# optional	: krb5 openldap

pkgname=postgresql
pkgver=17.6
pkgrel=1
source=(https://ftp.postgresql.org/pub/source/v$pkgver/$pkgname-$pkgver.tar.bz2
        $pkgname.hooks)

build() {
	cd $pkgname-$pkgver

    sed -i '/DEFAULT_PGSOCKET_DIR/s@/tmp@/run/postgresql@' src/include/pg_config_manual.h &&

    ./configure \
        --prefix=/usr \
        --enable-nls \
        --enable-thread-safety \
        --with-openss \
        --with-perl \
        --with-python \
        --with-tcl \
        --docdir=/usr/share/doc/$pkgname-$pkgver
    make
	make DESTDIR="$pkgdir" install
    make DESTDIR="$pkgdir" install-docs

    install -v -dm700 "$pkgdir"/srv/pgsql/data &&
    install -v -dm755 "$pkgdir"/run/postgresql &&
    chown -Rv postgres:postgres "$pkgdir"/srv/pgsql "$pkgdir"/run/postgresql

    install -Dm755 "$srcdir"/$pkgname.hooks "$pkgdir"/usr/share/blfs-bootscripts/hooks/$pkgname.hooks
}
