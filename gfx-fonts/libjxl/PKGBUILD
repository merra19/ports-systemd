# description	: JPEG XL image format reference implementation
# depends	: brotli highway lcms2 gdk-pixbuf giflib libpng libavif
# depends	: libjpeg-turbo shared-mime-info cmake libwebp java

pkgname=libjxl
pkgver=0.11.1
pkgrel=1
source=(https://github.com/libjxl/libjxl/archive/v$pkgver/$pkgname-$pkgver.tar.gz)

build() {
	cd $pkgname-$pkgver

    if [ -z "$JAVA_HOME" ];then
        echo "JAVA_HOME not set.  source /etc/profile"
        abort 1
    fi

    cmake -B build \
        -D CMAKE_INSTALL_PREFIX=/usr \
        -D CMAKE_BUILD_TYPE=Release \
        -D BUILD_TESTING=OFF \
        -D BUILD_SHARED_LIBS=ON \
        -D JPEGXL_ENABLE_SKCMS=OFF \
        -D JPEGXL_ENABLE_SJPEG=OFF \
        -D JPEGXL_ENABLE_PLUGINS=ON \
        -D JPEGXL_INSTALL_JARDIR=/usr/share/java \
        -G Ninja 
    ninja -C build
	DESTDIR="$pkgdir" ninja install -C build
}