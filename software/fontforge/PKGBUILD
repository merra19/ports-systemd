# description	: postscript font editor and converter
# depends	: giflib libtiff libtool libxml2 python glib cmake libpng
# depends	: libjpeg-turbo readline xorg-proto xorg-libs py3-sphinx
# depends	: woff2 gtk3 libspiro

pkgname=fontforge
pkgver=20230101
pkgrel=1
options=(!lto)
source=(https://github.com/$pkgname/$pkgname/releases/download/$pkgver/$pkgname-$pkgver.tar.xz
        https://www.linuxfromscratch.org/patches/blfs/12.4/fontforge-20230101-security_fixes-1.patch)

build() {
	cd $pkgname-$pkgver
    
    # Fix two security vulnerabilities in the Splinefont functionality:
    patch -Np1 -i ../fontforge-20230101-security_fixes-1.patch

    # Fix a problem with old translations exposed by gettext-0.22:
    sed -i.orig 's/\(%[^%[:space:]]*\)hs/\1s/g' \
    fontforgeexe/searchview.c po/de.po po/ca.po \
    po/hr.po po/it.po po/pl.po po/uk.po po/en_GB.po \
    po/fr.po po/vi.po po/ko.po po/ja.po

    cmake -B build \
		-D CMAKE_BUILD_TYPE=Release \
		-D CMAKE_INSTALL_PREFIX=/usr \
		-D ENABLE_MAINTAINER_TOOLS=TRUE \
		-D ENABLE_FONTFORGE_EXTRAS=TRUE \
		-D UNIX=TRUE \
        -D ENABLE_DOCS=TRUE \
        -D ENABLE_X11=ON \
        -D ENABLE_LIBSPIRO=ON
	make -C build
    make DESTDIR="$pkgdir" install -C build

    ln -sv fontforge "$pkgdir"/usr/share/doc/$pkgname-$pkgver
}