# description	: Free file archiver for extremely high compression
# depends	: glibc xz

pkgname=7zip
pkgver=25.01
pkgrel=1
source=(https://github.com/ip7z/7zip/archive/$pkgver/$pkgname-$pkgver.tar.gz)

build() {
    cd $pkgname-$pkgver
    
    for i in Bundles/{Alone,Alone7z,Format7zF,SFXCon} UI/Console; do
        make -C CPP/7zip/$i -f ../../cmpl_gcc.mak
    done

    install -d "$pkgdir"/usr/lib "$pkgdir"/usr/bin "$pkgdir"/usr/share/doc/$pkgname-$pkgver
    
    install -vDm755 CPP/7zip/Bundles/Alone{/b/g/7za,7z/b/g/7zr} \
                    CPP/7zip/Bundles/Format7zF/b/g/7z.so        \
                    CPP/7zip/UI/Console/b/g/7z                  \
                    -t "$pkgdir"/usr/lib/7zip/ 

    install -vm755 CPP/7zip/Bundles/SFXCon/b/g/7zCon \
                "$pkgdir"/usr/lib/7zip/7zCon.sfx           &&

    (for i in 7z 7za 7zr; do
        cat > "$pkgdir"/usr/bin/$i << EOF || exit
    #!/bin/sh
    exec /usr/lib/7zip/$i "\$@"
EOF
        chmod 755 "$pkgdir"/usr/bin/$i || exit
    done) &&

    cp -rv DOC -T "$pkgdir"/usr/share/doc/$pkgname-$pkgver
}