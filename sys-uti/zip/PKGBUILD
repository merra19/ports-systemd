# description	: Info ZIP (encryption support)
# depends	: bzip2

pkgname=zip
pkgver=3.0
_version=30
pkgrel=1
options=(!lto)
source=(https://downloads.sourceforge.net/infozip/zip${_version}.tar.gz
		https://src.fedoraproject.org/rpms/zip/raw/rawhide/f/zip-3.0-format-security.patch)

build() {
	cd $pkgname${_version}

	patch -p1 -i ../zip-3.0-format-security.patch

	sed -e "/^CFLAGS_NOOPT =/s/\$/ $CPPFLAGS $CFLAGS/" -i unix/Makefile
	sed -e "s/^LFLAGS1=''/LFLAGS1=$LDFLAGS/" -i unix/configure

	make -f unix/Makefile generic CC="gcc -std=gnu89"
    make prefix="$pkgdir"/usr MANDIR="$pkgdir"/usr/share/man/man1 -f unix/Makefile install
}