# description	: xdg-desktop-portal backend for hyprland
# depends	: hyprlang hyprutils hyprwayland-scanner inih sdbus-cpp
# depends	: util-linux pipewire qt6 xdg-desktop-portal cmake
# depends	: wayland wayland-protocols

pkgname=xdg-desktop-portal-hyprland
pkgver=1.3.9
_protocolver=4d29e48433270a2af06b8bc711ca1fe5109746cd
pkgrel=1
source=($pkgname-$pkgver.tar.gz::https://github.com/hyprwm/$pkgname/archive/refs/tags/v$pkgver.tar.gz
        https://github.com/hyprwm/hyprland-protocols/archive/$_protocolver.tar.gz
        hyprland-portals.conf)

build() {
	cd $pkgname-$pkgver

	rm -rf hyprland-protocols sdbus-cpp
	ln -sfT "$srcdir/hyprland-protocols-$_protocolver" hyprland-protocols


	cmake -B build \
		-D CMAKE_INSTALL_PREFIX=/usr \
		-D CMAKE_INSTALL_LIBEXECDIR=/usr/lib \
		-D CMAKE_BUILD_TYPE=Release
	cmake --build build
    DESTDIR="$pkgdir" cmake --install build

    install -Dm0644 -t "$pkgdir"/usr/share/xdg-desktop-portal/ "$srcdir"/hyprland-portals.conf
}