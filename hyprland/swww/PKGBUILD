# description	: Efficient animated wallpaper daemon for wayland, controlled at runtime
# depends	: glibc lz4 rustc

pkgname=swww
pkgver=0.11.2
pkgrel=1
source=($pkgname-$pkgver.tar.gz::https://github.com/LGFae/swww/archive/v$pkgver.tar.gz)

build() {
	cd $pkgname-$pkgver

    export RUSTUP_TOOLCHAIN=stable
    cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"

    export CARGO_TARGET_DIR=target
    cargo build --frozen --release --all-features

    install -Dm755 -t "$pkgdir"/usr/bin target/release/swww target/release/swww-daemon

    install -Dm644 completions/swww.bash "$pkgdir"/usr/share/bash-completion/completions/swww
    install -Dm644 completions/swww.fish "$pkgdir"/usr/share/fish/vendor_completions.d/swww.fish
    install -Dm644 completions/_swww "$pkgdir"/usr/share/zsh/site-functions/_swww
    install -Dm644 completions/swww.elv "$pkgdir"/usr/share/elvish/lib/swww.elv
}