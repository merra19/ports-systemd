# description	: A Client that groks URL
# depends	: openssl-32 zlib-32 zstd-32 nghttp2-32 libpsl-32
# depends	: libssh2-32 gnutls-32 libidn2-32 brotli-32 curl

pkgname=curl-32
_pkgname=curl
pkgver=8.16.0
pkgrel=1
options=(!lto)
source=(https://curl.se/download/$_pkgname-$pkgver.tar.xz)

build() {
    cd $_pkgname-$pkgver

	export CC="gcc -m32 -mstackrealign"
	export CXX="g++ -m32 -mstackrealign"
	export PKG_CONFIG_LIBDIR="/usr/lib32/pkgconfig"

    ./configure \
        --prefix=/usr \
        --libdir=/usr/lib32 \
        --disable-static \
		--disable-ares \
		--enable-ipv6 \
		--with-libidn2 \
		--with-nghttp2 \
		--with-openssl \
		--with-zsh-functions-dir \
		--with-fish-functions-dir \
		--with-pic \
        --with-ca-path=/etc/ssl/certs \
        --without-gssapi
    make
    make DESTDIR="$PWD"/DESTDIR install
    mkdir -p "$pkgdir"/usr/lib32
    cp -Rv DESTDIR/usr/lib32/* "$pkgdir"/usr/lib32
}