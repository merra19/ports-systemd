# description	: Various useful Linux utilities
# depends	: libxcrypt-32 pcre2-32 ncurses-32 zlib-32 readline-32 
# depends	: systemd-32 sqlite-32 util-linux

pkgname=util-linux-32
_pkgname=util-linux
pkgver=2.41.1
pkgrel=1
options=(strip)
source=(https://www.kernel.org/pub/linux/utils/util-linux/v${pkgver:0:4}/${_pkgname}-$pkgver.tar.xz)

build() {
    cd ${_pkgname}-$pkgver

	export CC="gcc -m32 -mstackrealign"
	export CXX="g++ -m32 -mstackrealign"
	export PKG_CONFIG_LIBDIR="/usr/lib32/pkgconfig"

    export NCURSES6_CONFIG=false NCURSES5_CONFIG=false
	export NCURSESW6_CONFIG=false NCURSESW5_CONFIG=false

    ./configure \
        --libdir=/usr/lib32 \
        --host=i686-pc-linux-gnu \
        --bindir=/usr/bin \
        --runstatedir=/run \
        --sbindir=/usr/sbin \
        --disable-chfn-chsh \
        --disable-login \
        --disable-nologin \
        --disable-su \
        --disable-setpriv \
        --disable-runuser \
        --disable-pylibmount \
        --disable-liblastlog2 \
        --disable-static \
        --without-python \
        --without-systemd \
        --without-systemdsystemunitdir \
        ADJTIME_PATH=/var/lib/hwclock/adjtime
    make

    mkdir -p "$pkgdir"/usr/lib32
    make DESTDIR=$PWD/DESTDIR install
    cp -Rv DESTDIR/usr/lib32/* "$pkgdir"/usr/lib32

    unset NCURSES6_CONFIG NCURSES5_CONFIG NCURSESW6_CONFIG NCURSESW5_CONFIG
}