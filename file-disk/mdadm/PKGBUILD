# description	: Tool for running RAID systems - replacement for the raidtools
# depends	: xz util-linux

pkgname=mdadm
pkgver=4.4
pkgrel=1
source=(https://www.kernel.org/pub/linux/utils/raid/mdadm/$pkgname-$pkgver.tar.xz
        mdadm.conf)
backup=(etc/mdadm.conf)

build() {
    cd $pkgname-$pkgver

    # Fix a build error introduced by gcc-15
    sed -e "s/__u8 signature\[4\]/& __attribute__ ((nonstring))/" \
        -i platform-intel.h
   
    make CWFLAGS="-Wall" CXFLAGS="${CFLAGS}"
    make DESTDIR="$pkgdir" CWFLAGS="-Wall" CXFLAGS="${CFLAGS}" BINDIR=/usr/sbin install
    
    install -Dm 644 ../mdadm.conf "$pkgdir"/etc/mdadm.conf
}