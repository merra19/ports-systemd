# description	: Create, destroy, resize, check, copy partitions and file systems
# depends	: lvm2 e2fsprogs util-linux readline ncurses pkgconf
# depends	: dosfstools

pkgname=parted
pkgver=3.6
pkgrel=1
source=(https://mirror.lyrahosting.com/gnu/$pkgname/$pkgname-$pkgver.tar.xz)

build() {
	cd $pkgname-$pkgver

	# First, make the package compatible with gcc-15
	sed -i 's/do_version ()/do_version (PedDevice** dev, PedDisk** diskp)/' parted/parted.c

	./configure --prefix=/usr \
                --disable-static \
                --enable-device-mapper
	make
	make -C doc html  
	makeinfo --html      -o doc/html       doc/parted.texi &&
	makeinfo --plaintext -o doc/parted.txt doc/parted.texi
	make DESTDIR="$pkgdir" install
    
	install -v -m755 -d "$pkgdir"/usr/share/doc/$pkgname-$pkgver/html &&
	install -v -m644    doc/html/* "$pkgdir"/usr/share/doc/$pkgname-$pkgver/html &&
	install -v -m644    doc/{FAT,API,parted.{txt,html}} "$pkgdir"/usr/share/doc/$pkgname-$pkgver
}