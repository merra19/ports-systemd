# description	: Media player for the command line
# depends	: libass libplacebo ffmpeg xorg-libs alsa-lib uchardet
# depends	: mesa libglvnd libjpeg-turbo pipewire pulseaudio shaderc
# depends	: wireplumber libva libvdpau vulkan-loader wayland 
# depends	: wayland-protocols libxkbcommon zlib xorg-proto luajit 
# depends	: linux-api-headers libcdio-paranoia libdvdnav libdvdcss
# depends	: libdvdread sdl2

pkgname=mpv
pkgver=0.40.0
pkgrel=3
options=(!lto)
source=(https://github.com/mpv-player/mpv/archive/refs/tags/v$pkgver/$pkgname-$pkgver.tar.gz)

build() {
	cd $pkgname-$pkgver

    # Add a fix to build with FFMpeg > 7.0 
    sed -i 's/AV_OPT_TYPE_CHANNEL_LAYOUT/AV_OPT_TYPE_CHLAYOUT/' filters/f_lavfi.c
    # Add a fix to build with FFMpeg > 8.0 
    #sed -i 's/FF_PROFILE_/AV_PROFILE_/' demux/demux_mkv.c

	meson setup \
        --prefix=/usr \
        --buildtype=plain \
        -D x11=enabled \
        -D sdl2="$(scratch isinstalled sdl2 && echo "enabled" || echo "disabled")" \
        -D dvdnav="$(scratch isinstalled libdvdnav && echo "enabled" || echo "disabled")" \
        -D lua=enabled \
        build
	ninja -C build
    DESTDIR="$pkgdir" ninja install -C build
}
