# description	: Complete solution to record/convert/stream audio and video. Includes libavcodec
# depends	: bzip2 libass freetype lame gnutls libvorbis libvpx opus 
# depends	: x264 x265 alsa-lib yasm dav1d libaom fdk-aac libva
# depends	: libdrm libjxl libwebp openjpeg speexdsp vulkan-loader
# depends	: v4l-utils libvdpau fontconfig fribidi pulseaudio
# depends	: libcdio-paranoia libplacebo libdvdnav
# todo      : frei0r
# optional  : samba

pkgname=ffmpeg
pkgver=7.1.1
pkgrel=1
source=(https://ffmpeg.org/releases/$pkgname-$pkgver.tar.xz
        https://www.linuxfromscratch.org/patches/blfs/12.4/ffmpeg-$pkgver-chromium_method-1.patch)

build() {
	cd $pkgname-$pkgver

    patch -Np1 -i ../ffmpeg-$pkgver-chromium_method-1.patch

	./configure \
        --prefix=/usr \
		--enable-gpl \
		--enable-version3 \
		--enable-nonfree \
		--disable-static \
		--enable-shared \
		--disable-debug \
		--enable-libass \
		--enable-libdav1d \
		--enable-libfreetype \
		--enable-libmp3lame \
		--enable-libopus \
		--enable-libvorbis \
		--enable-libvpx \
		--enable-libx264 \
		--enable-libx265 \
		--enable-openssl \
        --enable-vaapi \
        --disable-doc \
        --enable-lto \
        --enable-libaom \
        --enable-libfdk-aac \
        --enable-vaapi \
		--enable-libpulse \
		--enable-libplacebo \
		--docdir=/usr/share/doc/$pkgname-$pkgver
	make &&      
	gcc tools/qt-faststart.c -o tools/qt-faststart

	make DESTDIR="$pkgdir" install
	install -m755 tools/qt-faststart "$pkgdir"/usr/bin

	install -v -m755    tools/qt-faststart "$pkgdir"/usr/bin &&
	install -v -m755 -d "$pkgdir"/usr/share/doc/$pkgname-$pkgver
	install -v -m644    doc/*.txt "$pkgdir"/usr/share/doc/$pkgname-$pkgver
}
