# description	: IEEE 802.1X/WPA supplicant for secure wireless transfers
# depends	: libnl dbus openssl ncurses readline libxml2

pkgname=wpa_supplicant
pkgver=2.11
pkgrel=1
options=(!lto)
source=(https://w1.fi/releases/$pkgname-$pkgver.tar.gz
        config)

build() {
	cd $pkgname-$pkgver
    
    cp ../config wpa_supplicant/.config
    cd wpa_supplicant 

    make BINDIR=/usr/sbin LIBDIR=/usr/lib

    mkdir -p "$pkgdir"/usr/sbin/ "$pkgdir"/usr/bin/ "$pkgdir"/usr/lib/systemd/system/
    install -v -m755 wpa_cli wpa_passphrase wpa_supplicant "$pkgdir"/usr/sbin/

    install -v -m644 doc/docbook/wpa_supplicant.conf.5 "$pkgdir"/usr/share/man/man5/ &&
    install -v -m644 doc/docbook/wpa_cli.8 doc/docbook/wpa_passphrase.8 doc/docbook/wpa_supplicant.8 "$pkgdir"/usr/share/man/man8/

    install -v -m644 systemd/*.service /usr/lib/systemd/system/
        install -v -Dm644 dbus/fi.w1.wpa_supplicant1.service \
                    "$pkgdir"/usr/share/dbus-1/system-services/fi.w1.wpa_supplicant1.service
    install -v -d -m755 "$pkgdir"/etc/dbus-1/system.d 
    install -v -m644 dbus/dbus-wpa_supplicant.conf \
                    "$pkgdir"/etc/dbus-1/system.d/wpa_supplicant.conf
}
