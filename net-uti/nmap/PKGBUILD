# description	: Network exploration tool and security / port scanner
# depends	: liblinear libpcap libssh2 lua pcre2 py3-gobject zlib
# depends	: openssl py3-build

pkgname=nmap
pkgver=7.98
pkgrel=1
source=(https://nmap.org/dist/$pkgname-$pkgver.tar.bz2)

build() {
    cd $pkgname-$pkgver

    # Make the build system use the Setuptools Python module from LFS
    # instead of downloading a copy from the Internet, and install the
    # Python wheels already created when running the make instead of 
    #rebuilding them again on make install
    sed -ri Makefile.in \
        -e 's#-m build#& --no-isolation#'  \
        -e '/pip install/s#(ZENMAP|NDIFF)DIR\)/#&dist/*.whl#'

    # Remove a useless dependency on setuptools-gettext
    sed 's/, "setuptools-gettext"//' -i zenmap/pyproject.toml

    ./configure \
        --prefix=/usr 
    make
    make DESTDIR="$pkgdir" install

    pip3 install build  --root "$pkgdir"
}