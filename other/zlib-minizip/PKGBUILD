# description	: Standard (de)compression library
# depends	: glibc

pkgname=zlib-minizip
pkgver=1.3.1
pkgrel=1
source=(https://www.zlib.net/fossils/zlib-$pkgver.tar.gz)

getversionpkg() {
    awk 'NR==1 {print $1}' /var/lib/scratchpkg/db/$1 2>/dev/null
}

build() {
    cd zlib-$pkgver

    vers="$(getversionpkg zlib)"
    
    if [ ! "$vers" == "$pkgver" ]; then
        echo "$pkgname version is $vers // $pkgver"
        abort 1
    fi

    cd contrib/minizip

    export CFLAGS+=" -DUNALIGNED_OK -D_REENTRANT -D_LARGEFILE64_SOURCE=1 "
  
    cp Makefile Makefile.orig
    autoreconf -fiv
  
    ./configure \
        --prefix=/usr \
        --enable-static=no
    make
    make DESTDIR="$pkgdir" install

    rm "$pkgdir/usr/include/minizip/crypt.h"
}
