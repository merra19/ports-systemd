# description	: GPU-accelerated terminal emulator
# depends	: fontconfig freetype libxkbcommon libxcb mesa zlib 
# depends	: ncurses wayland xorg-libs scdoc

pkgname=alacritty
pkgver=0.15.1
pkgrel=1
source=($pkgname-$pkgver.tar.gz::https://github.com/alacritty/alacritty/archive/refs/tags/v$pkgver.tar.gz)

build() {
	cd $pkgname-$pkgver

    cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"
    CARGO_INCREMENTAL=0 cargo build --release --locked --offline

    desktop-file-install -m 644 --dir "$pkgdir/usr/share/applications/" "extra/linux/Alacritty.desktop"
    install -D -m755 "target/release/alacritty" "$pkgdir/usr/bin/alacritty"
    scdoc < "extra/man/alacritty.1.scd" | install -D -m644 /dev/stdin \
            "$pkgdir/usr/share/man/man1/alacritty.1"
    scdoc < "extra/man/alacritty.5.scd" | install -D -m644 /dev/stdin \
            "$pkgdir/usr/share/man/man5/alacritty.5"
    scdoc < "extra/man/alacritty-msg.1.scd" | install -D -m644 /dev/stdin \
            "$pkgdir/usr/share/man/man1/alacritty-msg.1"
    scdoc < "extra/man/alacritty-bindings.5.scd" | install -D -m644 /dev/stdin \
            "$pkgdir/usr/share/man/man5/alacritty-bindings.5"
    install -D -m644 "extra/linux/org.alacritty.Alacritty.appdata.xml" "$pkgdir/usr/share/metainfo/org.alacritty.Alacritty.appdata.xml"
    install -D -m644 "extra/completions/alacritty.bash" "$pkgdir/usr/share/bash-completion/completions/alacritty"
    install -D -m644 "extra/completions/_alacritty" "$pkgdir/usr/share/zsh/site-functions/_alacritty"
    install -D -m644 "extra/completions/alacritty.fish" "$pkgdir/usr/share/fish/vendor_completions.d/alacritty.fish"
    install -D -m644 "extra/logo/compat/alacritty-term.svg" "$pkgdir/usr/share/pixmaps/Alacritty.svg"
}