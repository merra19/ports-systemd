# description	: System files

pkgname=filesystem
pkgver=35
pkgrel=2
source=(hosts os-release lsb-release inputrc shells group passwd
        profile dircolors.sh extrapaths.sh readline.sh umask.sh i18n.sh
        bashrc dot_bash_profile dot_profile dot_bashrc dot_bash_logout 
        resolv.conf sysctl.conf nsswitch.conf locale.conf adjtime hostname
        bash_completion.sh vconsole.conf noclear.conf maxuse.conf)
backup=(etc/shells etc/inputrc etc/resolv.conf etc/locale.conf etc/hosts 
        etc/bashrc etc/sysctl.conf etc/hostname etc/group etc/passwd)

build() {
    install --directory --mode=0755 --owner=root --group=root "$pkgdir"/etc/profile.d
    install --directory --mode=0755 --owner=root --group=root "$pkgdir"/etc/bash_completion.d
    install --directory --mode=0755 --owner=root --group=root "$pkgdir"/etc/skel/
    install --directory --mode=0755 --owner=root --group=root "$pkgdir"/etc/profile.d

    install -dm 0750 "$pkgdir"/root 
    install -d "$pkgdir"/etc

    install -m 0644 profile "$pkgdir"/etc/profile
    install -m 0644 nsswitch.conf locale.conf resolv.conf hosts shells "$pkgdir"/etc/
    install -m 0644 inputrc bashrc adjtime vconsole.conf hostname "$pkgdir"/etc/
	install -m 0644 group passwd "$pkgdir"/etc/

    # os-release lsb-release
    install -m 644 os-release "$pkgdir"/etc/os-release
    install -m 644 lsb-release "$pkgdir"/etc/lsb-release

    install -m 755 dircolors.sh extrapaths.sh readline.sh umask.sh i18n.sh "$pkgdir"/etc/profile.d/
    # install -m 755 bash_completion.sh "$pkgdir"/etc/profile.d/

    install -Dm 644 sysctl.conf "$pkgdir"/etc/sysctl.conf

    for i in dot_bash_profile dot_profile dot_bashrc dot_bash_logout; do
        j=${i/dot_/.}
        install -m 750 $i "$pkgdir"/root/$j
        install -m 750 $i "$pkgdir"/etc/skel/$j
    done

    mkdir -pv  "$pkgdir"/{boot,home,mnt,opt,srv,run}
	mkdir -pv "$pkgdir"/{dev,proc,sys}

    mkdir -pv  "$pkgdir"/usr/lib/firmware
    mkdir -pv  "$pkgdir"/media/{floppy,cdrom}
    mkdir -pv  "$pkgdir"/usr/{,local/}{include,src}
    mkdir -pv  "$pkgdir"/usr/lib/locale
    mkdir -pv  "$pkgdir"/usr/local/{bin,lib,sbin}
    mkdir -pv  "$pkgdir"/usr/{,local/}share/{color,dict,doc,info,locale,man}
    mkdir -pv  "$pkgdir"/usr/{,local/}share/{misc,terminfo,zoneinfo}
    mkdir -pv  "$pkgdir"/usr/{,local/}share/man/man{1..8}
    mkdir -pv  "$pkgdir"/var/{cache,local,log,mail,opt,spool}
    mkdir -pv  "$pkgdir"/var/lib/{color,misc,locate}

    echo r12.4-systemd > "$pkgdir"/etc/lfs-release

    install -d -m 755 "$pkgdir"/etc/systemd/system/getty@tty1.service.d
    install -m 0644 noclear.conf "$pkgdir"/etc/systemd/system/getty@tty1.service.d/noclear.conf
    install -d -m 755 "$pkgdir"/etc/systemd/coredump.conf.d
    install -m 0644 maxuse.conf "$pkgdir"/etc/systemd/coredump.conf.d/maxuse.conf

    mkdir -p "$pkgdir"/boot/efi 

	ln -sfv /run "$pkgdir"/var/run
	ln -sfv /run/lock "$pkgdir"/var/lock

	# log files
	touch "$pkgdir"/var/log/{btmp,lastlog,faillog,wtmp}
	chgrp utmp "$pkgdir"/var/log/lastlog
	chmod 664  "$pkgdir"/var/log/lastlog
	chmod 600  "$pkgdir"/var/log/btmp
}
