# description	: Microcode update image for AMD CPUs
# depends	: linux-firmware

pkgname=amd-ucode
pkgver=20250808
pkgrel=1
options=(!lto)
source=(https://www.kernel.org/pub/linux/kernel/firmware/linux-firmware-$pkgver.tar.xz)

build() {
    mkdir -p kernel/x86/microcode
    cat linux-firmware-$pkgver/amd-ucode/microcode_amd*.bin > kernel/x86/microcode/AuthenticAMD.bin

    echo kernel/x86/microcode/AuthenticAMD.bin | bsdcpio -o -H newc -R 0:0 > amd-ucode.img

    install -Dt "$pkgdir"/boot -m644 amd-ucode.img
}
