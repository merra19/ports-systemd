# description	: High-performance, full-featured text search engine based off of lucene in C++
# depends	: cmake ninja boost

pkgname=clucene
pkgver=2.3.3.4
pkgrel=1
options=(!lto)
source=(https://downloads.sourceforge.net/clucene/clucene-core-$pkgver.tar.gz
        https://www.linuxfromscratch.org/patches/blfs/12.4/clucene-$pkgver-contribs_lib-1.patch)

build() {
	cd $pkgname-core-$pkgver

    patch -Np1 -i ../clucene-$pkgver-contribs_lib-1.patch 

    sed -i '/Misc.h/a #include <ctime>' src/core/CLucene/document/DateTools.cpp

	cmake -B build \
        -D CMAKE_INSTALL_PREFIX=/usr \
		-D CMAKE_BUILD_TYPE=Release \
        -D CMAKE_POLICY_VERSION_MINIMUM=3.5 \
        -D BUILD_CONTRIBS_LIB=ON
	make -C build
    make DESTDIR="$pkgdir" install -C build
}