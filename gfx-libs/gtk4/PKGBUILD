# description	: GTK is a multi-platform toolkit for creating graphical user interfaces
# depends	: glib pango gdk-pixbuf hicolor-icon-theme sassc librsvg
# depends	: libepoxy graphene iso-codes gobject-introspection cups
# depends	: vulkan-loader wayland-protocols linux-api-headers libvpx
# depends	: shaderc colord xorg-proto py3-gobject libcloudproviders
# depends	: adwaita-icon-theme
# optional  : gstreamer!!gst-plugins-good gstreamer!!gst-plugins-bad
# todo      : tinysparql


pkgname=gtk4
_pkgname=gtk
pkgver=4.18.6
pkgrel=1
source=(https://download.gnome.org/sources/gtk/${pkgver%.*}/gtk-$pkgver.tar.xz
        settings.ini)

build() {
	cd ${_pkgname}-$pkgver

    # First, fix a problem when building with gcc-15
    sed -e '939 s/= { 0, }//' \
            -e '940 a memset (&transform, 0, sizeof(GtkCssTransform));' \
            -i gtk/gtkcsstransformvalue.c

	meson setup \
        --prefix=/usr \
        --buildtype=plain \
        -D broadway-backend=true \
        -D introspection=enabled \
        -D vulkan=enabled \
        -D cloudproviders=enabled \
        -D colord=enabled \
        -D tracker=disabled \
        -D media-gstreamer="$(scratch isinstalled gst-plugins-bad && echo enabled || echo disabled)" \
        build
	ninja -C build
	DESTDIR="$pkgdir" ninja install -C build

    install -Dm 644 "$srcdir"/settings.ini "$pkgdir"/etc/gtk-4.0/settings.ini
}
